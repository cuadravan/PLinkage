<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="PLinkageApp.ViewsWindows.SkillProviderLinkagesView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:PLinkageApp.Controls"
    xmlns:viewmodels="clr-namespace:PLinkageApp.ViewModels"
    Title="Offers and Applications"
    Shell.NavBarIsVisible="False">

    <RefreshView Command="{Binding RefreshCommand}" IsRefreshing="{Binding IsBusy, Mode=OneWay}">
        <ScrollView Padding="30">
            <VerticalStackLayout Spacing="20">

                <Grid ColumnDefinitions="*, Auto" VerticalOptions="Center">
                    <VerticalStackLayout Spacing="5">
                        <Label
                            FontAttributes="Bold"
                            FontSize="28"
                            Text="Offers &amp; Applications"
                            TextColor="#212121" />
                        <Label
                            FontSize="14"
                            Text="Manage your applications and received offers."
                            TextColor="Gray" />
                    </VerticalStackLayout>

                    <Button
                        Grid.Column="1"
                        BackgroundColor="Transparent"
                        BorderColor="#E0E0E0"
                        BorderWidth="1"
                        Command="{Binding RefreshCommand}"
                        CornerRadius="8"
                        FontAttributes="Bold"
                        HeightRequest="40"
                        Text="âŸ³ Refresh"
                        TextColor="#7C4DFF"
                        WidthRequest="100" />
                </Grid>

                <BoxView HeightRequest="1" Color="#E0E0E0" />

                <Grid ColumnDefinitions="*, *, *, *" ColumnSpacing="20">

                    <VerticalStackLayout Grid.Column="0" Spacing="10">
                        <Label
                            FontAttributes="Bold"
                            FontSize="18"
                            HorizontalOptions="Center"
                            Text="Sent Applications (Pending)"
                            TextColor="#212121" />

                        <CollectionView ItemsSource="{Binding SentApplicationsPending}">
                            <CollectionView.EmptyView>
                                <Label
                                    FontAttributes="Italic"
                                    HorizontalOptions="Center"
                                    Text="No pending applications."
                                    TextColor="Gray" />
                            </CollectionView.EmptyView>
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout ItemSpacing="10" Orientation="Vertical" />
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <controls:OfferApplicationCard
                                        AcceptCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=AcceptCommand}"
                                        AwaitingResponse="{Binding AwaitingResponse}"
                                        CommandParameter="{Binding .}"
                                        DeclineCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=RejectCommand}"
                                        FormattedConcernedName="{Binding FormattedConcernedName}"
                                        FormattedRate="{Binding FormattedRate}"
                                        FormattedTimeFrame="{Binding FormattedTimeFrame}"
                                        IsNegotiable="{Binding IsNegotiable}"
                                        IsNegotiating="{Binding IsNegotiating}"
                                        NegotiateCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=NegotiateCommand}"
                                        OfferApplicationStatus="{Binding OfferApplicationStatus}"
                                        OfferApplicationType="{Binding OfferApplicationType}"
                                        ProjectName="{Binding ProjectName}"
                                        ViewConcernedCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=ViewConcernedCommand}"
                                        ViewProjectCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=ViewProjectCommand}" />
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Column="1" Spacing="10">
                        <Label
                            FontAttributes="Bold"
                            FontSize="18"
                            HorizontalOptions="Center"
                            Text="Received Offers (Pending)"
                            TextColor="#212121" />

                        <CollectionView ItemsSource="{Binding ReceivedOffersPending}">
                            <CollectionView.EmptyView>
                                <Label
                                    FontAttributes="Italic"
                                    HorizontalOptions="Center"
                                    Text="No pending offers."
                                    TextColor="Gray" />
                            </CollectionView.EmptyView>
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout ItemSpacing="10" Orientation="Vertical" />
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <controls:OfferApplicationCard
                                        AcceptCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=AcceptCommand}"
                                        AwaitingResponse="{Binding AwaitingResponse}"
                                        CommandParameter="{Binding .}"
                                        DeclineCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=RejectCommand}"
                                        FormattedConcernedName="{Binding FormattedConcernedName}"
                                        FormattedRate="{Binding FormattedRate}"
                                        FormattedTimeFrame="{Binding FormattedTimeFrame}"
                                        IsNegotiable="{Binding IsNegotiable}"
                                        IsNegotiating="{Binding IsNegotiating}"
                                        NegotiateCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=NegotiateCommand}"
                                        OfferApplicationStatus="{Binding OfferApplicationStatus}"
                                        OfferApplicationType="{Binding OfferApplicationType}"
                                        ProjectName="{Binding ProjectName}"
                                        ViewConcernedCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=ViewConcernedCommand}"
                                        ViewProjectCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=ViewProjectCommand}" />
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Column="2" Spacing="10">
                        <Label
                            FontAttributes="Bold"
                            FontSize="18"
                            HorizontalOptions="Center"
                            Text="Sent Applications (History)"
                            TextColor="Gray" />

                        <CollectionView ItemsSource="{Binding SentApplicationsHistory}">
                            <CollectionView.EmptyView>
                                <Label
                                    FontAttributes="Italic"
                                    HorizontalOptions="Center"
                                    Text="No history."
                                    TextColor="Gray" />
                            </CollectionView.EmptyView>
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout ItemSpacing="10" Orientation="Vertical" />
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <controls:OfferApplicationCard
                                        AcceptCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=AcceptCommand}"
                                        AwaitingResponse="{Binding AwaitingResponse}"
                                        CommandParameter="{Binding .}"
                                        DeclineCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=RejectCommand}"
                                        FormattedConcernedName="{Binding FormattedConcernedName}"
                                        FormattedRate="{Binding FormattedRate}"
                                        FormattedTimeFrame="{Binding FormattedTimeFrame}"
                                        IsNegotiable="{Binding IsNegotiable}"
                                        IsNegotiating="{Binding IsNegotiating}"
                                        NegotiateCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=NegotiateCommand}"
                                        OfferApplicationStatus="{Binding OfferApplicationStatus}"
                                        OfferApplicationType="{Binding OfferApplicationType}"
                                        ProjectName="{Binding ProjectName}"
                                        ViewConcernedCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=ViewConcernedCommand}"
                                        ViewProjectCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=ViewProjectCommand}" />
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Column="3" Spacing="10">
                        <Label
                            FontAttributes="Bold"
                            FontSize="18"
                            HorizontalOptions="Center"
                            Text="Received Offers (History)"
                            TextColor="Gray" />

                        <CollectionView ItemsSource="{Binding ReceivedOffersHistory}">
                            <CollectionView.EmptyView>
                                <Label
                                    FontAttributes="Italic"
                                    HorizontalOptions="Center"
                                    Text="No history."
                                    TextColor="Gray" />
                            </CollectionView.EmptyView>
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout ItemSpacing="10" Orientation="Vertical" />
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <controls:OfferApplicationCard
                                        AcceptCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=AcceptCommand}"
                                        AwaitingResponse="{Binding AwaitingResponse}"
                                        CommandParameter="{Binding .}"
                                        DeclineCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=RejectCommand}"
                                        FormattedConcernedName="{Binding FormattedConcernedName}"
                                        FormattedRate="{Binding FormattedRate}"
                                        FormattedTimeFrame="{Binding FormattedTimeFrame}"
                                        IsNegotiable="{Binding IsNegotiable}"
                                        IsNegotiating="{Binding IsNegotiating}"
                                        NegotiateCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=NegotiateCommand}"
                                        OfferApplicationStatus="{Binding OfferApplicationStatus}"
                                        OfferApplicationType="{Binding OfferApplicationType}"
                                        ProjectName="{Binding ProjectName}"
                                        ViewConcernedCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=ViewConcernedCommand}"
                                        ViewProjectCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SkillProviderLinkagesViewModel}}, Path=ViewProjectCommand}" />
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>

                </Grid>
            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>