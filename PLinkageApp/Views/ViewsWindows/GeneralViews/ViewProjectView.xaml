<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="PLinkageApp.Views.ViewProjectView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:PLinkageApp.WindowsControls"
    xmlns:viewmodels="clr-namespace:PLinkageApp.ViewModels"
    Title="View Project"
    Shell.NavBarIsVisible="False">

    <RefreshView Command="{Binding RefreshCommand}" IsRefreshing="{Binding IsBusy, Mode=OneWay}">
        <ScrollView Padding="50">
            <VerticalStackLayout Spacing="20">

                <Grid ColumnDefinitions="*, Auto" VerticalOptions="Center">
                    <VerticalStackLayout Spacing="5">
                        <HorizontalStackLayout VerticalOptions="Center">
                            <Label
                                FontAttributes="Bold"
                                FontSize="32"
                                Text="{Binding Project.ProjectName}"
                                TextColor="#212121"
                                VerticalOptions="Center" />

                            <Button
                                Margin="10,-10,-10,0"
                                BackgroundColor="Transparent"
                                Command="{Binding RefreshCommand}"
                                CornerRadius="20"
                                FontSize="30"
                                HeightRequest="60"
                                Text="⟳"
                                TextColor="Black"
                                VerticalOptions="Center"
                                WidthRequest="60" />
                        </HorizontalStackLayout>
                        <HorizontalStackLayout Spacing="10">
                            <Label
                                FontSize="16"
                                Text="{Binding Project.ProjectLocation}"
                                TextColor="Gray"
                                VerticalOptions="Center" />
                            <BoxView
                                HeightRequest="15"
                                VerticalOptions="Center"
                                WidthRequest="1"
                                Color="Gray" />
                            <Label
                                FontAttributes="Bold"
                                FontSize="16"
                                Text="{Binding Project.ProjectOwnerName, StringFormat='Owner: {0}'}"
                                TextColor="#7C4DFF"
                                TextDecorations="Underline"
                                VerticalOptions="Center">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding ViewProjectOwnerCommand}" />
                                </Label.GestureRecognizers>
                            </Label>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>

                    <HorizontalStackLayout Grid.Column="1" Spacing="10">
                        <Button
                            BackgroundColor="#7C4DFF"
                            Command="{Binding UpdateProjectCommand}"
                            CornerRadius="6"
                            FontAttributes="Bold"
                            IsVisible="{Binding IsOwner}"
                            Text="Update Project"
                            TextColor="White" />
                        <Button
                            BackgroundColor="#388E3C"
                            Command="{Binding ApplyCommand}"
                            CornerRadius="6"
                            FontAttributes="Bold"
                            IsVisible="{Binding CanApply}"
                            Text="Apply Now"
                            TextColor="White" />
                        <Button
                            BackgroundColor="#D32F2F"
                            Command="{Binding ResignCommand}"
                            CornerRadius="6"
                            FontAttributes="Bold"
                            IsVisible="{Binding IsEmployed}"
                            Text="Resign"
                            TextColor="White" />
                    </HorizontalStackLayout>
                </Grid>

                <BoxView HeightRequest="1" Color="#E0E0E0" />

                <Grid ColumnDefinitions="2*, 20, 1*" RowDefinitions="Auto">

                    <VerticalStackLayout Grid.Column="0" Spacing="20">

                        <VerticalStackLayout Spacing="8">
                            <Label
                                FontAttributes="Bold"
                                FontSize="18"
                                Text="Description"
                                TextColor="#212121" />
                            <Label
                                FontSize="16"
                                Text="{Binding Project.ProjectDescription}"
                                TextColor="#424242" />
                        </VerticalStackLayout>

                        <Grid
                            ColumnDefinitions="*, *"
                            ColumnSpacing="15"
                            RowDefinitions="Auto, Auto"
                            RowSpacing="15">

                            <Border
                                Grid.Row="0"
                                Grid.Column="0"
                                Padding="15"
                                BackgroundColor="White"
                                Stroke="#E0E0E0"
                                StrokeShape="RoundRectangle 8">
                                <VerticalStackLayout Spacing="5">
                                    <Label
                                        FontSize="12"
                                        Text="Priority"
                                        TextColor="Gray" />
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        LineBreakMode="WordWrap"
                                        Text="{Binding Project.ProjectPriority}"
                                        TextColor="#212121" />
                                </VerticalStackLayout>
                            </Border>

                            <Border
                                Grid.Row="0"
                                Grid.Column="1"
                                Padding="15"
                                BackgroundColor="White"
                                Stroke="#E0E0E0"
                                StrokeShape="RoundRectangle 8">
                                <VerticalStackLayout Spacing="5">
                                    <Label
                                        FontSize="12"
                                        Text="Status"
                                        TextColor="Gray" />
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        LineBreakMode="WordWrap"
                                        Text="{Binding Project.ProjectStatus}"
                                        TextColor="#212121" />
                                </VerticalStackLayout>
                            </Border>

                            <Border
                                Grid.Row="1"
                                Grid.Column="0"
                                Padding="15"
                                BackgroundColor="White"
                                Stroke="#E0E0E0"
                                StrokeShape="RoundRectangle 8">
                                <VerticalStackLayout Spacing="5">
                                    <Label
                                        FontSize="12"
                                        Text="Duration"
                                        TextColor="Gray" />
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        LineBreakMode="WordWrap"
                                        Text="{Binding Project.ProjectDuration}"
                                        TextColor="#212121" />
                                </VerticalStackLayout>
                            </Border>

                            <Border
                                Grid.Row="1"
                                Grid.Column="1"
                                Padding="15"
                                BackgroundColor="White"
                                Stroke="#E0E0E0"
                                StrokeShape="RoundRectangle 8">
                                <VerticalStackLayout Spacing="5">
                                    <Label
                                        FontSize="12"
                                        Text="Resources Needed"
                                        TextColor="Gray" />
                                    <Label
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        LineBreakMode="WordWrap"
                                        Text="{Binding Project.ProjectResourcesNeeded}"
                                        TextColor="#212121" />
                                </VerticalStackLayout>
                            </Border>
                        </Grid>

                        <VerticalStackLayout Spacing="10">
                            <Label
                                FontAttributes="Bold"
                                FontSize="18"
                                Text="Required Skills"
                                TextColor="#212121" />
                            <Border
                                Padding="15"
                                BackgroundColor="White"
                                Stroke="#E0E0E0"
                                StrokeShape="RoundRectangle 8">
                                <FlexLayout
                                    BindableLayout.ItemsSource="{Binding Project.ProjectSkillsRequired}"
                                    JustifyContent="Start"
                                    Wrap="Wrap">
                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate>
                                            <controls:SkillPill Margin="0,0,8,8" SkillName="{Binding .}" />
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>
                                    <BindableLayout.EmptyView>
                                        <Label
                                            FontAttributes="Italic"
                                            Text="No specific skills listed."
                                            TextColor="Gray" />
                                    </BindableLayout.EmptyView>
                                </FlexLayout>
                            </Border>
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Column="2" Spacing="20">

                        <Border
                            Padding="15"
                            BackgroundColor="#F8F9FA"
                            Stroke="#E0E0E0"
                            StrokeShape="RoundRectangle 8">
                            <VerticalStackLayout Spacing="12">
                                <Label
                                    FontAttributes="Bold"
                                    FontSize="16"
                                    Text="Timeline"
                                    TextColor="#212121" />
                                <BoxView HeightRequest="1" Color="#E0E0E0" />

                                <Grid
                                    ColumnDefinitions="Auto, *"
                                    RowDefinitions="Auto, Auto, Auto, Auto"
                                    RowSpacing="8">
                                    <Label
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        Text="Start Date:"
                                        TextColor="Gray" />
                                    <Label
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        FontAttributes="Bold"
                                        HorizontalOptions="End"
                                        Text="{Binding Project.ProjectStartDate, StringFormat='{0:MMM dd, yyyy}'}" />

                                    <Label
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Text="End Date:"
                                        TextColor="Gray" />
                                    <Label
                                        Grid.Row="1"
                                        Grid.Column="1"
                                        FontAttributes="Bold"
                                        HorizontalOptions="End"
                                        Text="{Binding Project.ProjectEndDate, StringFormat='{0:MMM dd, yyyy}'}" />

                                    <Label
                                        Grid.Row="2"
                                        Grid.Column="0"
                                        Text="Created:"
                                        TextColor="Gray" />
                                    <Label
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        HorizontalOptions="End"
                                        Text="{Binding Project.ProjectDateCreated, StringFormat='{0:MMM dd, yyyy}'}" />

                                    <Label
                                        Grid.Row="3"
                                        Grid.Column="0"
                                        Text="Updated:"
                                        TextColor="Gray" />
                                    <Label
                                        Grid.Row="3"
                                        Grid.Column="1"
                                        HorizontalOptions="End"
                                        Text="{Binding Project.ProjectDateUpdated, StringFormat='{0:MMM dd, yyyy}'}" />
                                </Grid>
                            </VerticalStackLayout>
                        </Border>

                        <VerticalStackLayout Spacing="10">
                            <Label
                                FontAttributes="Bold"
                                FontSize="18"
                                Text="Employed Team"
                                TextColor="#212121" />

                            <CollectionView ItemsSource="{Binding Project.ProjectMembers}" MaximumHeightRequest="400">
                                <CollectionView.ItemsLayout>
                                    <LinearItemsLayout ItemSpacing="8" Orientation="Vertical" />
                                </CollectionView.ItemsLayout>
                                <CollectionView.EmptyView>
                                    <Border
                                        Padding="20"
                                        BackgroundColor="#F5F5F5"
                                        StrokeShape="RoundRectangle 8"
                                        StrokeThickness="0">
                                        <Label
                                            HorizontalOptions="Center"
                                            Text="No team members yet."
                                            TextColor="Gray" />
                                    </Border>
                                </CollectionView.EmptyView>
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                            Padding="10"
                                            BackgroundColor="White"
                                            Stroke="#7C4DFF"
                                            StrokeShape="RoundRectangle 8"
                                            StrokeThickness="1">
                                            <Grid ColumnDefinitions="*, Auto">
                                                <VerticalStackLayout Spacing="2">
                                                    <Label
                                                        FontAttributes="Bold"
                                                        Text="{Binding UserName}"
                                                        TextColor="#212121" />
                                                    <Label
                                                        FontSize="12"
                                                        Text="{Binding Email}"
                                                        TextColor="Gray" />
                                                    <Label
                                                        FontSize="12"
                                                        IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:ViewProjectViewModel}}, Path=IsOwner}"
                                                        Text="{Binding Rate, StringFormat='Rate: ₱{0} per hour'}"
                                                        TextColor="#7C4DFF" />
                                                    <Label
                                                        FontSize="12"
                                                        IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:ViewProjectViewModel}}, Path=IsOwner}"
                                                        Text="{Binding TimeFrame, StringFormat='Timeframe: {0} hour/s'}"
                                                        TextColor="#7C4DFF" />
                                                </VerticalStackLayout>

                                                <ImageButton
                                                    Grid.Column="1"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:ViewProjectViewModel}}, Path=ViewSkillProviderCommand}"
                                                    CommandParameter="{Binding .}"
                                                    HeightRequest="24"
                                                    Source="viewproject.png"
                                                    VerticalOptions="Center"
                                                    WidthRequest="24" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>

                    </VerticalStackLayout>
                </Grid>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>