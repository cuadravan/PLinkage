<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="PLinkageApp.Views.ProjectOwnerProfileView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:PLinkageApp.WindowsControls"
    xmlns:viewmodels="clr-namespace:PLinkageApp.ViewModels"
    Title="My Profile"
    Shell.NavBarIsVisible="False">

    <RefreshView Command="{Binding RefreshCommand}" IsRefreshing="{Binding IsBusy, Mode=OneWay}">
        <ScrollView Padding="0">
            <VerticalStackLayout Spacing="5">

                <controls:UserProfileCard
                    IsDeactivateActivateButtonVisible="False"
                    IsMessageButtonVisible="False"
                    IsRatingVisible="False"
                    IsSendOfferButtonVisible="False"
                    IsUpdateProfileButtonVisible="True"
                    JoinedDate="{Binding ProjectOwnerDto.JoinedOn}"
                    RefreshCommand="{Binding RefreshCommand}"
                    UpdateProfileCommand="{Binding UpdateProfileCommand}"
                    UserName="{Binding ProjectOwnerDto.UserName}"
                    UserSubtitle="{Binding ProjectOwnerDto.UserLocation}" />

                <VerticalStackLayout Padding="50" Spacing="20">
                    <controls:InformationCard
                        Title="Information"
                        Email="{Binding ProjectOwnerDto.UserEmail}"
                        Gender="{Binding ProjectOwnerDto.UserGender}"
                        Mobile="{Binding ProjectOwnerDto.UserPhone}" />

                    <BoxView HeightRequest="1" Color="#E0E0E0" />

                    <Grid ColumnDefinitions="*, Auto" VerticalOptions="Center">
                        <VerticalStackLayout Spacing="2">
                            <Label
                                FontAttributes="Bold"
                                FontSize="24"
                                Text="Owned Projects"
                                TextColor="#212121" />
                            <Label
                                FontSize="14"
                                Text="Manage your active projects"
                                TextColor="Gray" />
                        </VerticalStackLayout>

                        <Button
                            Grid.Column="1"
                            BackgroundColor="#7C4DFF"
                            Command="{Binding AddProjectCommand}"
                            CornerRadius="6"
                            FontAttributes="Bold"
                            HeightRequest="40"
                            Text="+ Create Project"
                            TextColor="White"
                            VerticalOptions="Center" />
                    </Grid>

                    <FlexLayout
                        AlignContent="Start"
                        AlignItems="Start"
                        BindableLayout.ItemsSource="{Binding ProjectOwnerDto.ProfileProjects}"
                        Direction="Row"
                        JustifyContent="Start"
                        Wrap="Wrap">

                        <BindableLayout.ItemTemplate>
                            <DataTemplate>
                                <controls:ProfileProjectCard
                                    Margin="0,0,10,10"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:ProjectOwnerProfileViewModel}}, Path=ViewProjectCommand}"
                                    CommandParameter="{Binding .}"
                                    IsOwner="False"
                                    ProjectName="{Binding ProjectName}"
                                    ProjectStatus="{Binding ProjectStatus}"
                                    WidthRequest="330" />
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>

                        <FlexLayout.Triggers>
                            <DataTrigger
                                Binding="{Binding ProjectOwnerDto.ProfileProjects.Count}"
                                TargetType="FlexLayout"
                                Value="0">
                                <Setter Property="IsVisible" Value="False" />
                            </DataTrigger>
                        </FlexLayout.Triggers>
                    </FlexLayout>

                    <Label
                        FontSize="16"
                        HorizontalOptions="Center"
                        IsVisible="{Binding ProjectOwnerDto.ProfileProjects.Count, Converter={StaticResource InverseCountToBoolConverter}}"
                        Text="You haven't created any projects yet."
                        TextColor="Gray" />
                    <Label
                        Margin="5,0,0,0"
                        FontSize="14"
                        Text="Tip: Tap on project to view more details/update"
                        TextColor="Gray"
                        VerticalOptions="Center" />

                    <Button
                        BackgroundColor="#D32F2F"
                        Command="{Binding ProcessResignationCommand}"
                        CornerRadius="8"
                        FontAttributes="Bold"
                        HeightRequest="50"
                        HorizontalOptions="Fill"
                        Text="Process Resignations"
                        TextColor="White" />
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>